<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Öğrenci Raporları - Duygu Pusulası</title>
    <style> 
    body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', sans-serif;
        background: url(static/images/arkaplan2.jpg) no-repeat center center fixed;
        background-size: cover;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .container {
        background: rgba(255, 255, 255, 0.85);
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 500px;
        transition: all 0.3s ease-in-out;
        width: 1000px;
        max-width: 1500px;   
        margin: 50px auto;      
  /}
        .reports-container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            width: 800px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .page-title {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .class-info {
            color: #666;
            font-size: 1.1em;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
        }
        
        .reports-list {
            display: grid;
            gap: 20px;
        }
        
        .report-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border-left: 4px solid #f093fb;
            transition: all 0.3s ease;
        }
        
        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .student-info {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        .report-date {
            color: #666;
            font-size: 0.9em;
        }
        
        .report-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            line-height: 1.6;
            color: #333;
        }
        
        .answers-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        .answers-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .answer-item {
            background: #f0f0f0;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .no-reports {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
    </style>
</head>

<body>
    <a href="/teacher-panel" class="back-btn">← Öğretmen Paneli</a>
    
    <div class="container">
        <div class="reports-container">
            <div class="page-header">
                <h1 class="page-title">Öğrenci Raporları</h1>
                <p class="class-info" id="class-info">Yükleniyor...</p>
            </div>
            
            <div id="reports-content">
                <div class="loading">Raporlar yükleniyor...</div>
            </div>
        </div>
    </div>
    <script src="{{url_for('static' , filename='script.js')}}"  defer></script>
    <script>
        // Sayfa yüklendiğinde raporları yükle
        document.addEventListener('DOMContentLoaded', function() {
            // Öğretmen bilgilerini API'den al
            loadTeacherInfo();
            
            // Raporları yükle
            loadReports();
        });
        
        function loadTeacherInfo() {
            // Öğretmen bilgilerini session'dan al
            fetch('/api/teacher-info')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('class-info').textContent = `${data.class_name} Sınıfı`;
                    } else {
                        // Eğer bilgi yoksa çıkış yap
                        window.location.href = '/logout';
                    }
                })
                .catch(error => {
                    console.error('Öğretmen bilgisi yükleme hatası:', error);
                    window.location.href = '/logout';
                });
        }
        
        function loadReports() {
            // Python session'ından sınıf raporlarını al
            fetch('/api/class-reports')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Rapor hatası:', data.error);
                        document.getElementById('reports-content').innerHTML = 
                            '<div class="no-reports">Raporlar yüklenirken bir hata oluştu.</div>';
                        return;
                    }
                    displayReports(data.reports);
                })
                .catch(error => {
                    console.error('Rapor yükleme hatası:', error);
                    document.getElementById('reports-content').innerHTML = 
                        '<div class="no-reports">Raporlar yüklenirken bir hata oluştu.</div>';
                });
        }
        
        function displayReports(reports) {
            const container = document.getElementById('reports-content');
            
            if (!reports || reports.length === 0) {
                container.innerHTML = '<div class="no-reports">Henüz hiç rapor bulunmuyor.</div>';
                return;
            }
            
            let html = '<div class="reports-list">';
            
            reports.forEach(report => {
                const date = new Date(report.created_at).toLocaleDateString('tr-TR');
                
                html += `
                    <div class="report-card">
                        <div class="report-header">
                            <div class="student-info">${report.student_name} ${report.student_surname}</div>
                            <div class="report-date">${date}</div>
                        </div>
                        
                        <div class="report-content">
                            ${report.ai_report.replace(/\n/g, '<br>')}
                        </div>
                        
                        <div class="answers-section">
                            <div class="answers-title">Öğrencinin Cevapları:</div>
                            ${report.answers.map(answer => `
                                <div class="answer-item">
                                    <strong>Adım ${answer.step}:</strong> ${answer.choice_value}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
    </script>
</body>
</html> 